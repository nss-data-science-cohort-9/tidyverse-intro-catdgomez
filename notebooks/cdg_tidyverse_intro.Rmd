---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code.

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*.

```{r}

```

```{r}
library(tidyverse)
```

1.  Using the read_csv() function, read the GDP dataset into your notebook as a tibble called gdp_df. After reading it in, inspect the first 10 rows and then inspect the last 10 rows.

```{r}

gdp_df <- read_csv("../data/gdp_per_capita.csv")

head(gdp_df, 10)

```

```{r}
tail(gdp_df, 10)
```

2.  Drop the 'Value Footnotes' column, and rename the remaining columns to 'Country', 'Year', and 'GDP_Per_Capita'.

```{r}

gdp_df_drop <- gdp_df |> 
  select(-`Value Footnotes`)


gdp_df_drop

```

```{r}

gdp_df_drop_rename <- gdp_df_drop |> 
  rename(c(GDP_Per_Capita = Value, Country = `Country or Area`))

gdp_df_drop_rename
```

3.  Which years are represented in this dataset? How many observations are there per year? Make a plot to view the number of observations per year.

```{r}
min(gdp_df_drop_rename[,2])
max(gdp_df_drop_rename[,2])
```

How many observations are there per year?

```{r}
no_obsv_year <- gdp_df_drop_rename |> 
  count(Year)
no_obsv_year
```

Make a plot to view the number of observations per year.

```{r}
no_obsv_year |> 
  ggplot(aes(x = Year, y = n)) + 
    geom_col()
```

4.  How many countries are represented in this dataset? Which countries have the fewest observations?

```{r}

no_obsv_ctry <- gdp_df_drop_rename |> 
  count(Country)
no_obsv_ctry

```

```{r}

gdp_df_drop_rename |> 
  distinct(Country[!is.na(Country)])

gdp_df_drop_rename |> 
  distinct(Country)

```

```{r}

length(unique(gdp_df_drop_rename$Country))

```

Which countries have the fewest observations?

```{r}

min(no_obsv_ctry$n)

```

```{r}
no_obsv_ctry |> 
  mutate(freq = min(n))

```

```{r}

tail(sort(no_obsv_ctry$Country), 3)

```

```{r}

with(unique(no_obsv_ctry[c("Country", "n")]), table(no_obsv_ctry))
```

```{r}
table(gdp_df_drop_rename$Country)
```

```{r}

num_obsv_ctry <- gdp_df_drop_rename |> 
  count(Country, sort = TRUE, name = "num_obsv_of_ctry")
tail(num_obsv_ctry)

```

```{r}
lowest_num_obsrv_ctry <- num_obsv_ctry |> 
  arrange(num_obsv_of_ctry) |> 
  slice(1:5)
lowest_num_obsrv_ctry
```

```{r}
min(num_obsv_ctry$num_obsv_of_ctry, na.rm = TRUE)
```

5.  Create a new tibble by subsetting gdp_df to just the year 2021. Call this new tibble gdp_2021.

```{r}

gdp_2021 <- gdp_df_drop_rename |> 
  filter(Year == "2021")

gdp_2021

```

```{r}
gdp_2021 |> 
  count(Year)
min(gdp_2021[,2])
max(gdp_2021[,2])
```

6.  Use summary() to find the summary statistics for GDP per capita in 2021.

```{r}

summary(gdp_2021$GDP_Per_Capita)
summary(gdp_2021)

```

7.  Create a histogram of GDP Per Capita numbers for 2021 (you may wish to adjust the number of bins for your histogram).

```{r}

ggplot( gdp_2021, aes( x= GDP_Per_Capita ) ) +
  geom_histogram( bins=50, color = "white", fill = "skyblue4" ) +
  labs(
    title = "GDP Per Capita in 2021",
    x = "GDP per Capita",
    y = "Frequency or Number of Countries"
  )

```

8.  Find the top 5 counties and bottom 5 countries by GDP per capita in 2021.

```{r}
num_obsv_ctry_2021 <- gdp_2021 |> 
  arrange(GDP_Per_Capita, sort = TRUE)

num_obsv_ctry_2021
head(num_obsv_ctry_2021)
tail(num_obsv_ctry_2021)
```

```{r}


lowest_gdp_2021 <- num_obsv_ctry_2021 |> 
  slice(1:5)

lowest_gdp_2021

```

```{r}

highest_gdp_2021 <- num_obsv_ctry_2021 |> 
  slice(tail(row_number(), 5))

highest_gdp_2021

```

9.  Now, return to the full dataset, gdp_df. Pivot the data for 1990 and 2021 (using pivot_wider() function) so that each row corresponds to a country, each column corresponds to a year, and the values in the table give the GDP_Per_Capita amount. Drop any rows that are missing values for either 1990 or 2021. Save the result to a tibble named gdp_pivoted.

```{r}


interim  <- gdp_df_drop_rename |>
  filter(Year == c(1990, 2021)) |> 

  pivot_wider(
      names_from = Year,
      values_from = GDP_Per_Capita
    )
gdp_pivoted <- interim[complete.cases(interim), ]
gdp_pivoted


```

10. Create a new column in gdp_pivoted named Percent_Change. This column should contain the percent change in GDP_Per_Capita from 1990 to 2021. Hint: Percent change is calculated as 100\*(New Value - Old Value) / Old Value.

```{r}

gdp_pivoted$Percent_Change <- round(((gdp_pivoted$`2021` - gdp_pivoted$`1990`) / gdp_pivoted$`1990` )* 100, 4)
# gdp_pivoted$Percent_Change <- (((gdp_pivoted$`2021` - gdp_pivoted$`1990`) / gdp_pivoted$`1990` )* 100)
gdp_pivoted
```

11. How many countries experienced a negative percent change in GDP per capita from 1990 to 2021? Nine (9) countries experienced a negative percent change in GDP per capita from 1990 to 2021.

```{r}

gdp_pivoted[gdp_pivoted[4] < 0, ]

```

12. Which country had the highest % change in GDP per capita? Create a line plot showing these country's GDP per capita for all years for which you have data. Put both line charts on the same plot.

```{r}

gdp_pivoted[which.max(gdp_pivoted$Percent_Change),]


gdp_pivoted |> 
    arrange(desc(Percent_Change)) |> 
    slice(1:5)

```

Create a line plot showing these country's GDP per capita for all years for which you have data.

```{r}

gdp_guyana  <- gdp_df_drop_rename |>
  filter(Country == "Guyana")
  
ggplot(data=gdp_guyana, aes(x=Year, y=GDP_Per_Capita, group=1)) +
  geom_line()+
  geom_point()

gdp_guyana

```

```{r}

gdp_albania  <- gdp_df_drop_rename |>
  filter(Country == "Albania")
  
ggplot(data=gdp_albania, aes(x=Year, y=GDP_Per_Capita, group=1)) +
  geom_line() +
  geom_point()

gdp_albania

```

Put both line charts on the same plot.

```{r}

gdp_albania
gdp_guyana

plot(gdp_albania$Year, gdp_albania$GDP_Per_Capita, 
     main = "GDP Per Capita Albania and Guyana 1990-2021",
     xlab = "Years",
     ylab = "GDP Per Capita",
     type = "l",
     ylim = c(0, 35000)
     )
# 
lines(gdp_guyana$Year, gdp_guyana$GDP_Per_Capita,
      lty = "dashed")
# 
labels <- c("Albania", "Guyana")
# 
legend("topleft", legend = labels,
       cex = 0.6,
       inset = 0.03,
       pch = NULL,
       lty = c(1, 2))

```

```{r}

ggplot(data=gdp_albania, aes(x=Year, y=GDP_Per_Capita, group=1)) +
  geom_line(color="red")+
  geom_point(color="red")+
  labs(x = "Year", y = "GDP_Per_capita") +
  geom_point(data=gdp_guyana, color="darkgreen", aes(x=Year, y=GDP_Per_Capita, group=1) +
  geom_line(color="darkgreen")
             )

```

13. Read in continents.csv contained in the data folder into a new tibble called continents. We will be using this tibble to add a new column to our dataset.

```{r}

continents <- read_csv("../data/continents.csv")


continents
# head(continents, 10)

```

14. Merge gdp_df and continents. Keep only the countries that appear in both data frames. Save the result back to gdp_df.

```{r}

gdp_df <- merge(gdp_df_drop_rename, continents, by="Country")
gdp_df
```

15. Determine the number of countries per continent. Create a bar chart showing this.

```{r}

num_continents <- gdp_df |> 
  group_by(Continent) |> 
  summarise(Num_Countries_per_Continent = n_distinct(Country))

num_continents

```

16. Create a boxplot showing GDP per capita in 2021 split out by continent. What do you notice?

```{r}

gdp_df_2021_continents  <- gdp_df |>
  filter(Year == 2021)

gdp_df_2021_continents

my_colors <- c("#FFA500", "#008000", "#1E90FF", "#FF1493", "red", "purple")

boxplot(GDP_Per_Capita ~ Continent, data = gdp_df_2021_continents,
      main = "GDP per Capita in 2021 by Continent", xlab = "Continents", ylab = "GDP Per Capita",
      col = my_colors, border = "black", notch = FALSE, notchwidth = 0.5,
      medcol = "white", whiskcol = "black", boxwex = 0.5, outpch = 19,
      outcol = "black"
      )
# text(seq_along(unique(gdp_df_2021_continents$Continent)), par("usr")[3], 
#     labels = seq_along(unique(gdp_df_2021_continents$Continent)), srt = 45, adj = c(1.1, 1.1), xpd = TRUE)

```

```{r}
# 
# boxplot(GDP_Per_Capita ~ Continent, data = gdp_df_2021_continents, pars  =  list(xaxt = "n"))
# axis(2, at=gdp_df_2021_continents$Continent, labels = TRUE)
# text(y = seq(0, 100, by=20), par("usr")[1], labels = lablist.y, srt = 45, pos = 2, xpd = TRUE)
# # axis(1, at=c(1,2), labels = FALSE)
# text(c(1:6), par("usr")[3] - 1, labels = gdp_df_2021_continents$Continent, srt = 45, pos = 1, xpd = TRUE)
# text(y = seq(1, 6, by=20), par("usr")[1], labels = gdp_df_2021_continents$Continents, srt = 45, pos = 1, xpd = TRUE)

```



```{r}

```

```{r}
```

```{r}
```

```{r}
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
